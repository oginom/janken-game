# じゃんけんボクサー - 仕様書

## 概要
Google MediaPipeのハンドトラッキングとThree.jsを使用したリアルタイムじゃんけんゲーム。
プレイヤーは両手でグー・チョキ・パーを出して、上から降ってくる相手の手に勝利することでスコアを稼ぐ。

## 技術スタック
- **ランタイム**: Node.js (pnpm)
- **ビルドツール**: Vite
- **言語**: TypeScript
- **ハンドトラッキング**: Google MediaPipe Hands
- **描画**: Three.js (2D描画)

## ゲームルール

### 基本ルール
- プレイヤーは左右の手でそれぞれ独立してグー・チョキ・パーを出す
- 上から降ってくる相手の手にタイミングよく勝つ手を出す
- 相手の手が自分の手に接触した瞬間に勝敗判定
- 勝ち: スコア+10点
- 負け: ライフ-3
- あいこ: ライフ-1
- ライフが0になるとゲームオーバー

### 初期設定
- 開始ライフ: 3
- 開始スコア: 0

### 勝敗判定
- グー > チョキ
- チョキ > パー
- パー > グー

## 画面構成

### 1. タイトル画面
#### UI要素
- **タイトル**: "じゃんけんボクサー"
- **ゲーム開始ボタン**
- **注意書き**: "このゲームでは端末のカメラを利用します。次の画面で同意を押してください。"
- **カメラ設定トグル**: カメラのON/OFF切り替え

#### 機能
- ゲーム開始ボタンをクリックするとプレイ画面(開始)へ遷移
- カメラ設定はローカルストレージに保存

### 2. プレイ画面(開始)
#### UI要素
- **ダイアログ**: "両手をチョキでスタート"
- カメラフィードの表示(カメラONの場合)

#### 機能
- MediaPipeハンドトラッキング開始
- 両手がチョキを認識したらプレイ開始

### 3. プレイ画面(プレイ中)
#### レイアウト
```
┌─────────────────────────────┐
│  [ライフ表示]    [スコア]     │
│                             │
│     ↓ 相手の手(降下中)       │
│                             │
│     ↓ 相手の手(次の手)       │
│                             │
│                             │
│  [左手画像]    [右手画像]     │
└─────────────────────────────┘
```

#### UI要素

**上部エリア**
- **ライフ表示**: ハート画像×3(失うと空のハート画像に変化)
- **スコア表示**: 数値で表示

**中央エリア**
- **相手の手**:
  - 上から下へ降下するグー/チョキ/パーの画像
  - 丸枠で囲まれている(グー=赤、チョキ=青、パー=緑)
  - 次に降ってくる手が停止状態で表示される(予告機能)

**下部エリア**
- **プレイヤーの手(左右)**:
  - MediaPipeで認識したグー/チョキ/パーの画像を表示
  - トラッキングできない間は直前の手を維持
  - 手を切り替えた時に跳ねるアニメーション

**背景**
- カメラON: カメラフィード + 白の半透明オーバーレイ
- カメラOFF: 背景画像 + 白の半透明オーバーレイ

#### ゲームフロー

**難易度調整**
- **トリガー**: 相手の手を5個倒すごとに難易度上昇
- **変化内容**:
  - 相手の手の降下速度が速くなる
  - 相手の手の出現インターバルが短くなる
  - 最初は片手ずつまたは両手同じ手 → 後半はランダムで両手別々の手

**難易度段階(例)**
| 段階 | 倒した数 | 降下速度 | インターバル | 出現パターン |
|------|----------|----------|--------------|--------------|
| 1 | 0-4 | 遅い | 3秒 | 片手のみ |
| 2 | 5-9 | 普通 | 2.5秒 | 片手または両手同じ |
| 3 | 10-14 | 速い | 2秒 | 両手(時々別々) |
| 4 | 15-19 | 高速 | 1.5秒 | 両手(ランダム) |
| 5+ | 20+ | 超高速 | 1秒 | 両手(完全ランダム) |

#### SE(効果音)
- **勝利時**: OK音
- **敗北/あいこ時**: ダメージ音
- **ゲームオーバー時**: ゲームオーバー音

### 4. ゲームオーバー画面
#### UI要素
- **最終スコア表示**
- **再挑戦ボタン**

#### 機能
- 再挑戦ボタンでプレイ画面(開始)へ戻る

## 技術仕様

### MediaPipe設定
- **モデル**: MediaPipe Hands
- **認識モード**: ジェスチャー認識
- **認識ジェスチャー**:
  - Closed_Fist → グー
  - Victory → チョキ
  - Open_Palm → パー

### Three.js描画
- **レンダラー**: WebGLRenderer
- **カメラ**: OrthographicCamera(2D描画用)
- **シーン構成**:
  - 背景レイヤー(カメラフィードまたは背景画像)
  - ゲームオブジェクトレイヤー(相手の手、プレイヤーの手)
  - UIレイヤー(ライフ、スコア)

### アセット(プレースホルダー)
以下はプレースホルダーで実装し、後で実際の画像に差し替え可能にする:

- **手の画像**: グー・チョキ・パー各3種(色違いまたはプレイヤー/相手用)
- **ライフ画像**: ハート(満タン)、空のハート
- **背景画像**: カメラOFF時の背景
- **丸枠画像**: 3色(赤・青・緑)または色設定で対応

## データ構造

### GameState
```typescript
interface GameState {
  phase: 'title' | 'ready' | 'playing' | 'gameover';
  score: number;
  lives: number;
  difficulty: number; // 難易度レベル
  defeatedCount: number; // 倒した相手の手の数
}
```

### Hand
```typescript
type HandType = 'rock' | 'scissors' | 'paper';

interface PlayerHands {
  left: HandType;
  right: HandType;
}
```

### EnemyHand
```typescript
interface EnemyHand {
  id: string;
  type: HandType;
  position: { x: number; y: number };
  target: 'left' | 'right'; // どちらの手に向かってくるか
  isPreview: boolean; // 次の手かどうか
}
```

## パフォーマンス要件
- フレームレート: 60 FPS目標
- MediaPipe処理: 30 FPS以上
- カメラ解像度: 640x480(バランス重視)

## ブラウザ対応
- Chrome/Edge (最新版)
- Safari (最新版)
- Firefox (最新版)
- カメラ・WebGL対応必須
